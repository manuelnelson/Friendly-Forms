FormsApp.factory("menuService",["$location","$rootScope","$resource","$routeParams","$q",function(a,b,c,d,e){var f={menuItems:[],userId:0,firstChildId:0,isInitialized:!1,clearActive:function(){angular.forEach(f.menuItems,function(a){for(var b=0;b<a.subMenuItems.length;b++)a.subMenuItems[b].itemClass="";a.itemClass=""})},getFirstChildId:function(){for(var a=0;a<f.menuItems.length;a++){var b=f.menuItems[a],c=_.find(b.subMenuItems,function(a){return a.path.toUpperCase().indexOf("/CHILD/")>-1});if(c){var d=/\/(child|Child)\/(\d*)/,e=c.path.match(d)[2];f.firstChildId=e}}},getMenu:function(b){var c=e.defer();return b?f.userId=b:b=f.userId,typeof b=="undefined"&&(b=0),f.menu.getList({Route:a.path(),UserId:b},function(a){f.setItems(a),f.isInitialized=!0,c.resolve(a)}),c.promise},getMenuGroupByPath:function(a){if(a.indexOf("/child/")>-1||a.indexOf("/Child/")>-1){f.firstChildId==0&&f.getFirstChildId();var b=/\/(child|Child)\/(\d*)/;a=a.replace(b,"/$1/"+f.firstChildId)}for(var c=0;c<f.menuItems.length;c++){var d=f.menuItems[c];if(d.path.toUpperCase()===a.toUpperCase())return{menuItem:d,subMenuItem:null};var e=_.find(d.subMenuItems,function(b){return b.path.toUpperCase()===a.toUpperCase()});if(e)return{menuItem:d,subMenuItem:e}}},goToFirstFormMenu:function(){var b=_.find(f.menuItems,function(a){return a.subMenuItems&&a.subMenuItems.length>0});b&&a.path(b.subMenuItems[0].path)},enableMenu:function(a){var b=f.getMenuGroupByPath(a);b.subMenuItem.disabled=!1},isActive:function(a){if(f.isInitialized){var b=f.getMenuGroupByPath(a);if(b.subMenuItem)return b.subMenuItem.itemClass==="active"}return!1},menu:c("/api/menus/:userId",{userId:"@userId"},{getList:{method:"GET",isArray:!0,params:{format:"json"}}}),nextMenu:function(){var b=f.getMenuGroupByPath(a.path()),c=_.indexOf(_.pluck(b.menuItem.subMenuItems,"path"),b.subMenuItem.path);if(c==b.menuItem.subMenuItems.length-1){var e="/Output/FormComplete/"+b.menuItem.text.replace(" ","")+"/user/"+d.userId;a.path(e);return}var g=b.menuItem.subMenuItems[c+1];a.path(g.path)},previousMenu:function(){var b=f.getMenuGroupByPath(a.path()),c=_.indexOf(_.pluck(b.menuItem.subMenuItems,"path"),b.subMenuItem.path),d=b.menuItem.subMenuItems[c-1];a.path(d.path)},saveCurrentForm:function(){var a;for(var c=0;c<f.menuItems.length;c++){var d=f.menuItems[c];a=_.find(d.subMenuItems,function(a){return a.iconClass==="icon-white icon-pencil"});if(a){var e=b.$root.currentScope;e.submit(!0);break}}},setActive:function(a,b){typeof b=="undefined"&&(b=!0),f.isInitialized?f.setActiveCallback(a,b):f.getMenu().then(function(){f.setActiveCallback(a,!1)})},setItems:function(a){f.menuItems=a},setSubMenuIconClass:function(a,b){var c=f.getMenuGroupByPath(a);c.subMenuItem&&(c.subMenuItem.iconClass=b)},setActiveCallback:function(b,c){c&&f.saveCurrentForm(),f.clearActive();var d=_.find(f.menuItems,function(a){return a.path===b});if(d)d.itemClass="active";else{var e=f.getMenuGroupByPath(b);e.menuItem.showSubMenu=!0,e.menuItem.itemClass="submenu active",e.subMenuItem.itemClass="active",e.subMenuItem.iconClass="icon-white icon-pencil",a.path()!==e.subMenuItem.path&&a.path(e.subMenuItem.path)}}};return f}])