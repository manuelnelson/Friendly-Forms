FormsApp.factory("menuService",["$location","$rootScope","$resource","$routeParams",function(a,b,c,d){var e={menuItems:[],userId:0,firstChildId:0,isInitialized:!1,clearActive:function(){angular.forEach(e.menuItems,function(a){for(var b=0;b<a.subMenuItems.length;b++)a.subMenuItems[b].itemClass="";a.itemClass=""})},checkForm:function(){var a;for(var c=0;c<e.menuItems.length;c++){var d=e.menuItems[c];a=_.find(d.subMenuItems,function(a){return a.iconClass==="icon-blue icon-pencil"});if(a){var f=b.$root.currentScope;f.submit(!0);break}}},children:c("/api/child/:userId",{userId:"@userId"},{update:{method:"PUT"}}),getFirstChildId:function(){for(var a=0;a<e.menuItems.length;a++){var b=e.menuItems[a],c=_.find(b.subMenuItems,function(a){return a.path.toUpperCase().indexOf("/CHILD/")>-1});if(c){var d=/\/(child|Child)\/(\d*)/,f=c.path.match(d)[2];e.firstChildId=f}}},getMenu:function(b){var c=e.userId;typeof c=="undefined"&&(c=0),e.menu.getList({Route:a.path(),UserId:c},function(a){e.setItems(a),e.isInitialized=!0,b&&b()})},getMenuGroupByPath:function(a){if(a.indexOf("/child/")>-1||a.indexOf("/Child/")>-1){e.firstChildId==0&&e.getFirstChildId();var b=/\/(child|Child)\/(\d*)/;a=a.replace(b,"/$1/"+e.firstChildId)}for(var c=0;c<e.menuItems.length;c++){var d=e.menuItems[c];if(d.path.toUpperCase()===a.toUpperCase())return{menuItem:d,subMenuItem:null};var f=_.find(d.subMenuItems,function(b){return b.path.toUpperCase()===a.toUpperCase()});if(f)return{menuItem:d,subMenuItem:f}}},isActive:function(a){if(e.isInitialized){var b=e.getMenuGroupByPath(a);if(b.subMenuItem)return b.subMenuItem.itemClass==="active"}return!1},menu:c("/api/menus/:userId",{userId:"@userId"},{getList:{method:"GET",isArray:!0,params:{format:"json"}}}),nextMenu:function(){var b=e.getMenuGroupByPath(a.path()),c=_.indexOf(_.pluck(b.menuItem.subMenuItems,"path"),b.subMenuItem.path);if(c==b.menuItem.subMenuItems.length-1){var f="/Output/FormComplete/"+b.menuItem.text.replace(" ","")+"/user/"+d.userId;a.path(f);return}var g=b.menuItem.subMenuItems[c+1];a.path(g.path)},previousMenu:function(){var b=e.getMenuGroupByPath(a.path()),c=_.indexOf(_.pluck(b.menuItem.subMenuItems,"path"),b.subMenuItem.path),d=b.menuItem.subMenuItems[c-1];a.path(d.path)},setActive:function(a){e.isInitialized?e.setActiveCallback(a)():e.getMenu(e.setActiveCallback(a))},setItems:function(a){e.menuItems=a},setSubMenuIconClass:function(a,b){var c=e.getMenuGroupByPath(a);c.subMenuItem&&(c.subMenuItem.iconClass=b)},setActiveCallback:function(b){return function(){e.checkForm(),e.clearActive();var c=_.find(e.menuItems,function(a){return a.path===b});if(c)c.itemClass="active";else{var d=e.getMenuGroupByPath(b);d.menuItem.showSubMenu=!0,d.menuItem.itemClass="submenu active",d.subMenuItem.itemClass="active",d.subMenuItem.iconClass="icon-blue icon-pencil",a.path(d.subMenuItem.path)}}}};return e}])