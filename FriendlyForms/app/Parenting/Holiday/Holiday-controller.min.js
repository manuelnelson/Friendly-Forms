var HolidayCtrl=function(a,b,c,d,e,f,g,h){function i(b){var c=angular.copy(a.extraHolidays);d.extraHolidays.get({ChildId:b},function(e){_.each(e.ExtraHolidays,function(a){var b=_.find(c,function(b){return b.HolidayName==a.HolidayName});b&&(b.Id=a.Id,b.ChildId=a.ChildId,d.extraHolidays.update(null,b,function(){}),c=_.reject(c,function(b){return b.HolidayName==a.HolidayName}))}),_.each(c,function(a){a.ChildId=b,d.extraHolidays.save(null,a,function(){})}),d.holidays.get({ChildId:b},function(c){var e=angular.copy(a.holiday);e.UserId=g.getFormUserId(),e.ChildId=b,typeof c.Id!="undefined"?(e.Id=c.Id,d.holidays.update(null,e,function(){a.showMessage=!0})):d.holidays.save(null,e,function(){a.showMessage=!0})})})}function j(a){var b;if(a.lastIndexOf("Mother")>=0&&a.lastIndexOf("Mother")>a.lastIndexOf("Father")){var c=a.substr(1);b=c.replace("Mother","Father"),b=a.substr(0,1)+b}else{var c=a.substr(1);b=c.replace("Father","Mother"),b=a.substr(0,1)+b}return b}function k(b){a.holiday.ChristmasFather=b,a.holiday.MlkFather=b,a.holiday.FallBreakFather=b,a.holiday.SpringBreakFather=b,a.holiday.ThanksgivingFather=b,a.holiday.PresidentsFather=b,a.holiday.MothersFather=b,a.holiday.MemorialFather=b,a.holiday.FathersFather=b,a.holiday.IndependenceFather=b,a.holiday.LaborFather=b,a.holiday.HalloweenFather=b,a.holiday.ChildrensFather=b,a.holiday.MothersBdayFather=b,a.holiday.FathersBdayFather=b,a.holiday.ReligiousFather=b,_.each(a.extraHolidays,function(a){a.HolidayFather=b})}function l(b){a.holiday.ChristmasMother=b,a.holiday.FallBreakMother=b,a.holiday.SpringBreakMother=b,a.holiday.ThanksgivingMother=b,a.holiday.PresidentsMother=b,a.holiday.MothersMother=b,a.holiday.MemorialMother=b,a.holiday.FathersMother=b,a.holiday.IndependenceMother=b,a.holiday.LaborMother=b,a.holiday.MlkMother=b,a.holiday.HalloweenMother=b,a.holiday.MothersBdayMother=b,a.holiday.ChildrensMother=b,a.holiday.FathersBdayMother=b,a.holiday.ReligiousMother=b,_.each(a.extraHolidays,function(a){a.HolidayMother=b})}function m(a){switch(parseInt(a)){case 1:return 2;case 2:return 1;case 3:return 4;case 4:return 3;case 5:return 5}return 0}a.path=c.path(),a.showErrors=!1,a.showMessage=!1,a.showExtraErrors=!1,a.isLoaded=!1,d.children.get({UserId:b.userId},function(c){a.children=c.Children,a.childNdx=_.indexOf(_.pluck(a.children,"Id"),parseInt(b.childId)),a.childName=a.children[a.childNdx].Name,a.menuPath="/Parenting/Holiday/user/"+b.userId+"/child/"+a.children[0].Id,e.isActive(a.menuPath)||e.setActive(a.menuPath)}),a.getChildHoliday=function(b){a.holiday=d.holidays.get({ChildId:b},function(){a.isLoaded=!0;if(typeof a.holiday.Id=="undefined"||a.holiday.Id==0)a.holiday=$.jStorage.get(a.path),a.holiday&&(a.showErrors=!0)}),d.extraHolidays.get({ChildId:b},function(b){b.ExtraHolidays.length===0&&(a.extraHolidays=[]),a.extraHolidays=b.ExtraHolidays})},a.addExtraHoliday=function(){if(a.extraHolidayForm.$invalid){a.showExtraErrors=!0;return}a.showExtraErrors=!1,a.extraHoliday.ChildId=b.childId,a.extraHoliday.UserId=g.getFormUserId(),d.extraHolidays.save(null,a.extraHoliday,function(b){a.extraHolidays.push(b),a.extraHoliday.HolidayName="",a.extraHoliday.HolidayFather=-1,a.extraHoliday.HolidayMother=-1,a.extraHolidayForm.$setPristine()})},a.submit=function(b,c){if(a.holidayForm.$invalid){e.setSubMenuIconClass(a.menuPath,"icon-exclamation icon-red");var h=f.getFormInput("#holidayForm");$.jStorage.set(a.path,h),a.showErrors=!0,c&&c();return}$.jStorage.deleteKey(a.path),a.holiday.UserId=g.getFormUserId(),a.holiday.ChildId=a.children[a.childNdx].Id,typeof a.holiday.Id=="undefined"||a.holiday.Id==0?d.holidays.save(null,a.holiday,function(){}):d.holidays.update({Id:a.holiday.Id},a.holiday,function(){}),e.setSubMenuIconClass(a.menuPath,"icon-ok icon-green");if(a.extraHolidays.length>0){var i=0;_.each(a.extraHolidays,function(b){d.extraHolidays.update(null,b,function(){i++,a.extraHolidays.length===i&&c&&c()})})}else c&&c()},a.previousChild=function(){a.submit(!1,function(){a.childNdx=_.indexOf(_.pluck(a.children,"Id"),parseInt(b.childId));if(a.childNdx===0){e.previousMenu();return}a.childNdx=a.childNdx-1;var d=a.children[a.childNdx].Id;c.path("/Parenting/Holiday/user/"+b.userId+"/child/"+d)})},a.nextChild=function(){a.submit(!1,function(){a.childNdx=_.indexOf(_.pluck(a.children,"Id"),parseInt(b.childId));if(a.childNdx===a.children.length-1){e.nextMenu();return}a.childNdx=a.childNdx+1;var d=a.children[a.childNdx].Id;e.setSubMenuIconClass(a.path,"icon-ok icon-green"),c.path("/Parenting/Holiday/user/"+b.userId+"/child/"+d)})},a.copyChild=function(c){a.submit(!1,function(){c===0?_.each(a.children,function(a){a.childId!=b.childId&&i(a.Id)}):i(c)})},a.matchValue=function(b){switch(b){case"Father":k(a.holiday.allFather),l(m(a.holiday.allFather));break;case"Mother":l(a.holiday.allMother),k(m(a.holiday.allMother));break;default:}},a.changeHoliday=function(b){var c=a.holiday[b],d=j(b),e=m(c);a.holiday[d]=e},a.changeExtraHoliday=function(b,c){if(c=="Father"){var d=a.extraHolidays[b].HolidayFather;a.extraHolidays[b].HolidayMother=m(d)}else{var d=a.extraHolidays[b].HolidayMother;a.extraHolidays[b].HolidayFather=m(d)}},a.changeAdditionalHoliday=function(b){var c=b.target.name;if(c.indexOf("Father")>0){var d=a.extraHoliday.HolidayFather;a.extraHoliday.HolidayMother=m(d)}else{var d=a.extraHoliday.HolidayMother;a.extraHoliday.HolidayFather=m(d)}},a.getChildHoliday(b.childId),f.refreshPage(function(){h.currentScope=a})};HolidayCtrl.$inject=["$scope","$routeParams","$location","holidayService","menuService","genericService","userService","$rootScope"]