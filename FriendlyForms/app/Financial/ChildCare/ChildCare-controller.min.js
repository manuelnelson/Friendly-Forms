var ChildCareCtrl=function(a,b,c,d,e,f,g,h){a.path=c.path(),a.showErrors=!1,a.showMessage=!1,a.isLoaded=!1,d.children.get({UserId:b.userId},function(c){a.children=c.Children,a.childNdx=_.indexOf(_.pluck(a.children,"Id"),parseInt(b.childId)),a.childName=a.children[a.childNdx].Name}),a.getChildChildCare=function(b){a.childCare=d.childCares.get({ChildId:b},function(){a.isLoaded=!0;if(typeof a.childCare.Id=="undefined"||a.childCare.Id==0)a.childCare=$.jStorage.get(a.path)})},a.childCareForm=d.childCareForms.get({UserId:b.userId},function(){if(typeof a.childCareForm.Id=="undefined"||a.childCareForm.Id==0)a.showErrors=!0}),a.submit=function(){if(!a.childCareForm||a.childCareForm.ChildrenInvolved!="1"&&a.childCareForm.ChildrenInvolved!="2"){e.setSubMenuIconClass(a.path,"icon-exclamation icon-red");return}a.showErrors=!1,a.childCareForm.UserId=g.getFormUserId(),typeof a.childCareForm.Id=="undefined"||a.childCareForm.Id==0?d.childCareForms.save(null,a.childCareForm,function(b){a.childCareForm.Id=b.Id,e.setSubMenuIconClass(a.path,"icon-ok icon-green")}):d.childCareForms.update(null,a.childCareForm,function(){e.setSubMenuIconClass(a.path,"icon-ok icon-green")})},a.submitChildCare=function(b){if(a.childCareChildForm.$invalid||a.childCare===null){e.setSubMenuIconClass(a.path,"icon-exclamation icon-red");var c=f.getFormInput("#childCareChildForm");$.jStorage.set(a.path,c),a.showErrors=!0,b&&b();return}$.jStorage.deleteKey(a.path),a.childCare.UserId=g.getFormUserId(),a.childCare.ChildId=a.children[a.childNdx].Id,typeof a.childCare.Id=="undefined"||a.childCare.Id==0?d.childCares.save(null,a.childCare,function(){e.setSubMenuIconClass(a.path,"icon-ok icon-green"),b()}):d.childCares.update({Id:a.childCare.Id},a.childCare,function(){e.setSubMenuIconClass(a.path,"icon-ok icon-green"),b()})},a.previousChild=function(){a.submitChildCare(function(){a.childNdx=_.indexOf(_.pluck(a.children,"Id"),parseInt(b.childId));if(a.childNdx===0)return;a.childNdx=a.childNdx-1;var d=a.children[a.childNdx].Id;c.path("/Financial/ChildCare/user/"+b.userId+"/child/"+d)})},a.nextChild=function(){a.submitChildCare(function(){if(!a.childCareForm.ChildrenInvolved||a.childCareForm.ChildrenInvolved==2){e.nextMenu();return}a.childNdx=_.indexOf(_.pluck(a.children,"Id"),parseInt(b.childId));if(a.childNdx===a.children.length-1){e.nextMenu();return}a.childNdx=a.childNdx+1;var d=a.children[a.childNdx].Id;e.setSubMenuIconClass(a.path,"icon-ok icon-green"),c.path("/Financial/ChildCare/user/"+b.userId+"/child/"+d)})},a.getChildChildCare(b.childId),f.refreshPage(function(){h.currentScope=a})};ChildCareCtrl.$inject=["$scope","$routeParams","$location","childCareService","menuService","genericService","userService","$rootScope"]