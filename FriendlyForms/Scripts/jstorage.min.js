(function(){function q(){var a=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),a=!0,window.localStorage.removeItem("_tmptest")}catch(b){}if(a)try{window.localStorage&&(e=window.localStorage,h="localStorage",k=e.jStorage_update)}catch(c){}else if("globalStorage"in window)try{window.globalStorage&&(e=window.globalStorage[window.location.hostname],h="globalStorage",k=e.jStorage_update)}catch(d){}else{f=document.createElement("link");if(!f.addBehavior){f=null;return}f.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(f);try{f.load("jStorage")}catch(g){f.setAttribute("jStorage","{}"),f.save("jStorage"),f.load("jStorage")}var i="{}";try{i=f.getAttribute("jStorage")}catch(j){}try{k=f.getAttribute("jStorage_update")}catch(l){}e.jStorage=i,h="userDataBehavior"}y(),B(),r("local"),r("session"),t(),C(),"addEventListener"in window&&window.addEventListener("pageshow",function(a){a.persisted&&u()},!1)}function r(a,e){function m(){if(a!="session")return;try{k=c.parse(window.name||"{}")}catch(b){k={}}}function n(){if(a!="session")return;window.name=c.stringify(k)}var f=!1,g=0,i,j,k={},l=Math.random();if(!e&&typeof window[a+"Storage"]!="undefined")return;if(a=="local"&&window.globalStorage){localStorage=window.globalStorage[window.location.hostname];return}if(h!="userDataBehavior")return;e&&window[a+"Storage"]&&window[a+"Storage"].parentNode&&window[a+"Storage"].parentNode.removeChild(window[a+"Storage"]),j=document.createElement("button"),document.getElementsByTagName("head")[0].appendChild(j),a=="local"?k=d:a=="session"&&m();for(i in k)k.hasOwnProperty(i)&&i!="__jstorage_meta"&&i!="length"&&typeof k[i]!="undefined"&&(i in j||g++,j[i]=k[i]);j.length=g,j.key=function(a){var b=0,c;m();for(c in k)if(k.hasOwnProperty(c)&&c!="__jstorage_meta"&&c!="length"&&typeof k[c]!="undefined"){if(b==a)return c;b++}},j.getItem=function(c){return m(),a=="session"?k[c]:b.jStorage.get(c)},j.setItem=function(a,b){if(typeof b=="undefined")return;j[a]=(b||"").toString()},j.removeItem=function(c){if(a=="local")return b.jStorage.deleteKey(c);j[c]=undefined,f=!0,c in j&&j.removeAttribute(c),f=!1},j.clear=function(){if(a=="session"){window.name="",r("session",!0);return}b.jStorage.flush()},a=="local"&&(p=function(a,b){if(a=="length")return;f=!0,typeof b=="undefined"?a in j&&(g--,j.removeAttribute(a)):(a in j||g++,j[a]=(b||"").toString()),j.length=g,f=!1}),j.attachEvent("onpropertychange",function(c){if(c.propertyName=="length")return;if(f||c.propertyName=="length")return;if(a=="local")!(c.propertyName in k)&&typeof j[c.propertyName]!="undefined"&&g++;else if(a=="session"){m(),typeof j[c.propertyName]=="undefined"||c.propertyName in k?typeof j[c.propertyName]=="undefined"&&c.propertyName in k?(delete k[c.propertyName],g--):k[c.propertyName]=j[c.propertyName]:(k[c.propertyName]=j[c.propertyName],g++),n(),j.length=g;return}b.jStorage.set(c.propertyName,j[c.propertyName]),j.length=g}),window[a+"Storage"]=j}function s(){var a="{}";if(h=="userDataBehavior"){f.load("jStorage");try{a=f.getAttribute("jStorage")}catch(b){}try{k=f.getAttribute("jStorage_update")}catch(c){}e.jStorage=a}y(),B(),C()}function t(){h=="localStorage"||h=="globalStorage"?"addEventListener"in window?window.addEventListener("storage",u,!1):document.attachEvent("onstorage",u):h=="userDataBehavior"&&setInterval(u,1e3)}function u(){var a;clearTimeout(j),j=setTimeout(function(){if(h=="localStorage"||h=="globalStorage")a=e.jStorage_update;else if(h=="userDataBehavior"){f.load("jStorage");try{a=f.getAttribute("jStorage_update")}catch(b){}}a&&a!=k&&(k=a,v())},25)}function v(){var a=c.parse(c.stringify(d.__jstorage_meta.CRC32)),b;s(),b=c.parse(c.stringify(d.__jstorage_meta.CRC32));var e,f=[],g=[];for(e in a)if(a.hasOwnProperty(e)){if(!b[e]){g.push(e);continue}a[e]!=b[e]&&String(a[e]).substr(0,2)=="2."&&f.push(e)}for(e in b)b.hasOwnProperty(e)&&(a[e]||f.push(e));w(f,"updated"),w(g,"deleted")}function w(a,b){a=[].concat(a||[]);if(b=="flushed"){a=[];for(var c in i)i.hasOwnProperty(c)&&a.push(c);b="deleted"}for(var d=0,e=a.length;d<e;d++)if(i[a[d]])for(var f=0,g=i[a[d]].length;f<g;f++)i[a[d]][f](a[d],b)}function x(){var a=(+(new Date)).toString();h=="localStorage"||h=="globalStorage"?e.jStorage_update=a:h=="userDataBehavior"&&(f.setAttribute("jStorage_update",a),f.save("jStorage")),u()}function y(){if(e.jStorage)try{d=c.parse(String(e.jStorage))}catch(a){e.jStorage="{}"}else e.jStorage="{}";g=e.jStorage?String(e.jStorage).length:0,d.__jstorage_meta||(d.__jstorage_meta={}),d.__jstorage_meta.CRC32||(d.__jstorage_meta.CRC32={})}function z(){E();try{e.jStorage=c.stringify(d),f&&(f.setAttribute("jStorage",e.jStorage),f.save("jStorage")),g=e.jStorage?String(e.jStorage).length:0}catch(a){}}function A(a){if(!a||typeof a!="string"&&typeof a!="number")throw new TypeError("Key name must be string or numeric");if(a=="__jstorage_meta")throw new TypeError("Reserved key name");return!0}function B(){var a,b,c,e,f=Infinity,g=!1,h=[];clearTimeout(n);if(!d.__jstorage_meta||typeof d.__jstorage_meta.TTL!="object")return;a=+(new Date),c=d.__jstorage_meta.TTL,e=d.__jstorage_meta.CRC32;for(b in c)c.hasOwnProperty(b)&&(c[b]<=a?(delete c[b],delete e[b],delete d[b],g=!0,h.push(b)):c[b]<f&&(f=c[b]));f!=Infinity&&(n=setTimeout(B,f-a)),g&&(z(),x(),w(h,"deleted"))}function C(){if(!d.__jstorage_meta.PubSub)return;var a,b=m;for(var c=len=d.__jstorage_meta.PubSub.length-1;c>=0;c--)a=d.__jstorage_meta.PubSub[c],a[0]>m&&(b=a[0],D(a[1],a[2]));m=b}function D(a,b){if(l[a])for(var d=0,e=l[a].length;d<e;d++)l[a][d](a,c.parse(c.stringify(b)))}function E(){if(!d.__jstorage_meta.PubSub)return;var a=+(new Date)-2e3;for(var b=0,c=d.__jstorage_meta.PubSub.length;b<c;b++)if(d.__jstorage_meta.PubSub[b][0]<=a){d.__jstorage_meta.PubSub.splice(b,d.__jstorage_meta.PubSub.length-b);break}d.__jstorage_meta.PubSub.length||delete d.__jstorage_meta.PubSub}function F(a,b){d.__jstorage_meta||(d.__jstorage_meta={}),d.__jstorage_meta.PubSub||(d.__jstorage_meta.PubSub=[]),d.__jstorage_meta.PubSub.unshift([+(new Date),a,b]),z(),x()}function G(a,b){var c=a.length,d=b^c,e=0,f;while(c>=4)f=a.charCodeAt(e)&255|(a.charCodeAt(++e)&255)<<8|(a.charCodeAt(++e)&255)<<16|(a.charCodeAt(++e)&255)<<24,f=(f&65535)*1540483477+(((f>>>16)*1540483477&65535)<<16),f^=f>>>24,f=(f&65535)*1540483477+(((f>>>16)*1540483477&65535)<<16),d=(d&65535)*1540483477+(((d>>>16)*1540483477&65535)<<16)^f,c-=4,++e;switch(c){case 3:d^=(a.charCodeAt(e+2)&255)<<16;case 2:d^=(a.charCodeAt(e+1)&255)<<8;case 1:d^=a.charCodeAt(e)&255,d=(d&65535)*1540483477+(((d>>>16)*1540483477&65535)<<16)}return d^=d>>>13,d=(d&65535)*1540483477+(((d>>>16)*1540483477&65535)<<16),d^=d>>>15,d>>>0}var a="0.3.2",b=window.jQuery||window.$||(window.$={}),c={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(a){return String(a).evalJSON()}||b.parseJSON||b.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||b.toJSON};if(!c.parse||!c.stringify)throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");var d={__jstorage_meta:{CRC32:{}}},e={jStorage:"{}"},f=null,g=0,h=!1,i={},j=!1,k=0,l={},m=+(new Date),n,o={isXML:function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1},encode:function(a){if(!this.isXML(a))return!1;try{return(new XMLSerializer).serializeToString(a)}catch(b){try{return a.xml}catch(c){}}return!1},decode:function(a){var b="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(a){var b=new ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b},c;return b?(c=b.call("DOMParser"in window&&new DOMParser||window,a,"text/xml"),this.isXML(c)?c:!1):!1}},p=function(){};b.jStorage={version:a,set:function(a,b,e){A(a),e=e||{};if(typeof b=="undefined")return this.deleteKey(a),b;if(o.isXML(b))b={_is_xml:!0,xml:o.encode(b)};else{if(typeof b=="function")return undefined;b&&typeof b=="object"&&(b=c.parse(c.stringify(b)))}return d[a]=b,d.__jstorage_meta.CRC32[a]="2."+G(c.stringify(b)),this.setTTL(a,e.TTL||0),p(a,b),w(a,"updated"),b},get:function(a,b){return A(a),a in d?d[a]&&typeof d[a]=="object"&&d[a]._is_xml?o.decode(d[a].xml):d[a]:typeof b=="undefined"?null:b},deleteKey:function(a){return A(a),a in d?(delete d[a],typeof d.__jstorage_meta.TTL=="object"&&a in d.__jstorage_meta.TTL&&delete d.__jstorage_meta.TTL[a],delete d.__jstorage_meta.CRC32[a],p(a,undefined),z(),x(),w(a,"deleted"),!0):!1},setTTL:function(a,b){var c=+(new Date);return A(a),b=Number(b)||0,a in d?(d.__jstorage_meta.TTL||(d.__jstorage_meta.TTL={}),b>0?d.__jstorage_meta.TTL[a]=c+b:delete d.__jstorage_meta.TTL[a],z(),B(),x(),!0):!1},getTTL:function(a){var b=+(new Date),c;return A(a),a in d&&d.__jstorage_meta.TTL&&d.__jstorage_meta.TTL[a]?(c=d.__jstorage_meta.TTL[a]-b,c||0):0},flush:function(){return d={__jstorage_meta:{CRC32:{}}},r("local",!0),z(),x(),w(null,"flushed"),!0},storageObj:function(){function a(){}return a.prototype=d,new a},index:function(){var a=[],b;for(b in d)d.hasOwnProperty(b)&&b!="__jstorage_meta"&&a.push(b);return a},storageSize:function(){return g},currentBackend:function(){return h},storageAvailable:function(){return!!h},listenKeyChange:function(a,b){A(a),i[a]||(i[a]=[]),i[a].push(b)},stopListening:function(a,b){A(a);if(!i[a])return;if(!b){delete i[a];return}for(var c=i[a].length-1;c>=0;c--)i[a][c]==b&&i[a].splice(c,1)},subscribe:function(a,b){a=(a||"").toString();if(!a)throw new TypeError("Channel not defined");l[a]||(l[a]=[]),l[a].push(b)},publish:function(a,b){a=(a||"").toString();if(!a)throw new TypeError("Channel not defined");F(a,b)},reInit:function(){s()}},q()})()