window.Friendly=window.Friendly||{},_.templateSettings.interpolate=/\{\{(.+?)\}\}/g,Friendly.properties={messageType:{Warning:"",Success:"alert-success",Error:"alert-error"},iconSuccess:"icon-green icon-ok",iconEdit:"icon-blue icon-pencil",iconError:"icon-red icon-pencil",numberRegEx:/(\d{1,5})/},Friendly.children=[],Friendly.childNdx=0,Friendly.StartLoading=function(){$("#loading").show(),$("body").css("cursor","wait")},Friendly.EndLoading=function(){$("#loading").hide(),$("body").css("cursor","default")},Friendly.ShowMessage=function(a,b,c,d){Friendly.EndLoading(),c=typeof c=="undefined"?Friendly.properties.messageType.Warning:c;var e={Title:a,Message:b,AlertType:c},f=$("#friendly-message-template").tmpl(e);typeof d=="undefined"&&(d="#main-content"),$(d).prepend(f),$("html, body").animate({scrollTop:$(d).offset().top},"fast")},Friendly.GenericErrorMessage=function(a,b,c){Friendly.EndLoading();if(a.responseText!=""&&a.responseText[0]!="<"){var d=JSON.parse(a.responseText);if(c==="Bad Request")return Friendly.ShowMessage("Input Error",d.ResponseStatus.Message,Friendly.properties.messageType.Error),!1}return Friendly.ShowMessage("Sorry!","We could not process your request.  The error has been logged and we will do our best to correct the error asap.",Friendly.properties.messageType.Error),!1},Friendly.SubmitForm=function(a,b,c){Friendly.StartLoading();var d=Friendly.IsGenericForm(a,b);if(d&&$("#"+a).valid()){typeof c=="undefined"&&(c=Friendly.GetFormInput(a)),Friendly.IsOtherForm(a)&&(a=a.substring(0,a.lastIndexOf("Other")));var e="POST";typeof c.Id!="undefined"&&c.Id!="0"&&c.Id!=""?e="PUT":c.Id=0,$.ajax({url:"/api/"+a+"?format=json",type:e,data:c,success:function(c){$("html, body").animate({scrollTop:0},"fast"),$("#"+a+"Id").length>0&&$("#"+a+"Id").val(c.Id),Friendly.NextForm(b,Friendly.properties.iconSuccess),Friendly.EndLoading()},error:Friendly.GenericErrorMessage})}else if(d)return Friendly.EndLoading(),!1;return!0},Friendly.AjaxSubmit=function(a,b,c){if(!$("#"+a).valid())return Friendly.NextForm(b,Friendly.properties.iconError),!1;typeof c=="undefined"&&(c=Friendly.GetFormInput(a));var d="POST";typeof c.Id!="undefined"&&c.Id!="0"&&(d="PUT"),$.ajax({url:"/api/"+a+"?format=json",type:d,data:c,success:function(){$("html, body").animate({scrollTop:0},"fast"),Friendly.NextForm(b,Friendly.properties.iconSuccess)},error:Friendly.GenericErrorMessage})},Friendly.IsOtherForm=function(a){var b=/Other/g;return a.search(b)!=-1?!0:!1},Friendly.NextForm=function(a,b){$("#sidebar .active").find("i").attr("class",b),$("#"+a+"Nav").find("i").attr("class",Friendly.properties.iconEdit),$(".wrapper").hide();switch(a){case"decisions":Friendly.LoadChildren("decision");break;case"holiday":Friendly.LoadChildren("holiday");break;case"childCare":Friendly.LoadChildren("childCare");break;case"extraExpense":Friendly.LoadChildren("extraExpense");break;case"deviations":Friendly.LoadChildren("deviations");break;case"deviationsOther":Friendly.LoadChildren("deviationsOther")}$("#sidebar li").removeClass("active"),$("#"+a+"Wrapper").show(),$("#"+a+"Nav").addClass("active"),Friendly.EndLoading()},Friendly.GetFormInput=function(a){var b={};return $.each($("#"+a).serializeArray(),function(a,c){c.name.indexOf(".")>=0&&(c.name=c.name.substring(c.name.indexOf(".")+1,c.name.length)),b[c.name]=c.value}),$("#"+a+"Id").length>0&&(b.Id=$("#"+a+"Id").val()),Friendly.IsOtherForm(a)&&(b.IsOtherParent="true"),b},Friendly.ClearForm=function(a){$("#"+a+" input, #"+a+" textarea").not(":button, :submit, :reset, :hidden, :radio, .timepicker").val("").removeAttr("selected"),$(":input","#"+a).not(":button, :submit, :reset, :hidden,").removeAttr("checked").removeAttr("selected")},Friendly.ValidateForms=function(a){var b=!0,c=[],d=$(".nav-item");for(var e=0;e<d.length;e++)!$(d[e]).find("i").hasClass("icon-ok")&&!$(d[e]).find("i").hasClass("icon-blue")&&(b=!1,c.push($(d[e]).find("a").text()));if(!b){var f="The following forms are still incomplete or have errors: ";for(var g=0;g<c.length;g++)f+=Friendly.FormInvalidationMessage(c[g]);return f=f.substring(0,f.lastIndexOf(",")),Friendly.ShowMessage("Almost there!",f,Friendly.properties.messageType.Error),$("html, body").animate({scrollTop:0},"fast"),!1}$(a).hide(),$(".viewOutput").show()},Friendly.FormInvalidationMessage=function(a){switch(a){case"Decisions":return Friendly.ChildDecisionError.length>1?"Decisions ("+Friendly.ChildDecisionError.join(",")+"), ":"Decisions ("+Friendly.ChildDecisionError[0]+"), ";case"Holidays":return Friendly.ChildHolidayError.length>1?"Holidays ("+Friendly.ChildHolidayError.join(",")+"), ":"Holidays ("+Friendly.ChildHolidayError[0]+"), ";default:return a+", "}},Friendly.IsGenericForm=function(a,b){var c=["house","vehicle","child","decisions","holiday","preexistingSupportForm","preexistingSupportFormOther","childCare","extraExpense","deviations","deviationsOther"];if(c.indexOf(a)>=0){switch(a){case"house":var d=Friendly.GetFormInput("house");d.Equity=$("#Equity").val().replace(/,/g,""),d.MoneyOwed=$("#MoneyOwed").val().replace(/,/g,""),d.RetailValue=$("#RetailValue").val().replace(/,/g,""),Friendly.AjaxSubmit(a,b,d);break;case"vehicle":Friendly.AjaxSubmit("vehicleForm",b);break;case"child":Friendly.AjaxSubmit("childForm",b);break;case"decisions":Parenting.AddDecision(),$("#"+a+"Wrapper").hide(),Friendly.childNdx=0;var e=Friendly.children[Friendly.childNdx];Friendly.ChildDecisionError=[],Parenting.CheckChildDecision(e,b);break;case"childCare":Financial.AddChildCare(null,!0),$("#"+a+"Wrapper").hide(),Friendly.childNdx=0;var e=Friendly.children[Friendly.childNdx];Friendly.ChildCareError=[],Financial.CheckChildCare(e,b);break;case"extraExpense":Financial.AddExtraExpense(null,!0),$("#"+a+"Wrapper").hide(),Friendly.childNdx=0;var e=Friendly.children[Friendly.childNdx];Friendly.ExtraExpenseError=[],Financial.CheckExtraExpense(e,b);break;case"deviations":Financial.AddDeviations(null,!0),$("#"+a+"Wrapper").hide(),Friendly.childNdx=0;var e=Friendly.children[Friendly.childNdx];Friendly.DeviationsError=[],Financial.CheckDeviations(e,b);break;case"deviationsOther":Financial.AddDeviationsOther(null,!0),$("#"+a+"Wrapper").hide(),Friendly.childNdx=0;var e=Friendly.children[Friendly.childNdx];Friendly.DeviationsErrorOther=[],Financial.CheckDeviationsOther(e,b);break;case"holiday":Parenting.AddHoliday(),$("#"+a+"Wrapper").hide(),Friendly.childNdx=0;var e=Friendly.children[Friendly.childNdx];Friendly.ChildHolidayError=[],Parenting.CheckChildHoliday(e,b);break;case"preexistingSupportForm":Friendly.NextForm(b,Friendly.properties.iconSuccess);break;case"preexistingSupportFormOther":Friendly.NextForm(b,Friendly.properties.iconSuccess)}return!1}return!0},Friendly.LoadChildren=function(a){Friendly.children=[],$(".copy-button ul").empty(),$(".copy-button ul").append('<li><a title="all" data-id="0">All</a></li>'),$.each($(".child-table tbody tr"),function(a,b){var c={Name:$(b).find(".child-name").text(),DateOfBirth:$(b).find(".child-dob").text(),Id:$(b).find(".child-id").text().trim()};Friendly.children.push(c)}),Friendly.children.length<=1&&$(".copy-wrapper").hide(),Friendly.childNdx=0;var b=Friendly.children[Friendly.childNdx];switch(a){case"decision":Parenting.GetChildDecisions(b);break;case"holiday":Parenting.GetChildHoliday(b);break;case"childCare":Financial.GetChildCare(b);break;case"extraExpense":Financial.GetExtraExpense(b);break;case"deviations":Financial.GetDeviations(b);break;case"deviationsOther":Financial.GetDeviationsOther(b)}},$(document).ready(function(){function b(){var a=$("#user-nav > ul").width();$("#user-nav > ul").css({width:a,"margin-left":"-"+a/2+"px"});var b=$("#content-header .btn-group").width();$("#content-header .btn-group").css({width:b,"margin-left":"-"+a/2+"px"})}$(".submenu > a").click(function(a){a.preventDefault();var b=$(this).siblings("ul"),c=$(this).parents("li"),d=$("#sidebar li.submenu ul"),e=$("#sidebar li.submenu");c.hasClass("open")?($(window).width()>768||$(window).width()<479?b.slideUp():b.fadeOut(250),c.removeClass("open")):($(window).width()>768||$(window).width()<479?(d.slideUp(),b.slideDown()):(d.fadeOut(250),b.fadeIn(250)),e.removeClass("open"),c.addClass("open"))});var a=$("#sidebar > ul");$("#sidebar > a").click(function(b){b.preventDefault();var c=$("#sidebar");c.hasClass("open")?(c.removeClass("open"),a.slideUp(250)):(c.addClass("open"),a.slideDown(250))}),$(window).resize(function(){$(window).width()>479&&(a.css({display:"block"}),$("#content-header .btn-group").css({width:"auto"})),$(window).width()<479&&(a.css({display:"none"}),b()),$(window).width()>768&&($("#user-nav > ul").css({width:"auto",margin:"0"}),$("#content-header .btn-group").css({width:"auto"}))}),$(window).width()<468&&(a.css({display:"none"}),b()),$(window).width()>479&&($("#content-header .btn-group").css({width:"auto"}),a.css({display:"block"})),$(".hoverHelp").popover({placement:"left",title:"Tip",trigger:"hover"}),$("input[type=checkbox]").click(function(){var a=$(this).attr("checked");a!=undefined?$(this).val(!0):$(this).val(!1)}),$.validator.addMethod("textlineinput",function(a,b,c){return this.optional(b)?!0:a.split("\\")[0]===c}),$.validator.unobtrusive.adapters.add("textlineinput",["name"],function(a){a.rules.textlineinput=a.params.name,a.message&&(a.messages.textlineinput=a.message)});var c=$("form"),d=[],e=[],f=[];for(var g=0;g<c.length;g++){var h=$.data(c[g],"validator").settings;d[g]=h.errorPlacement,e[g]=h.success,f[g]=h.invalidHandler,h.formNdx=g,h.errorPlacement=function(a,b){$(b).closest(".control-group").addClass("error"),!!$.data(c[this.formNdx],"validator").valid(),d[this.formNdx](a,b)},h.success=function(a){$(a).closest(".control-group").removeClass("error"),e[this.formNdx](a)},h.invalidHandler=function(a){f[this.formNdx]()}}$(".datepicker").datepicker(),$(".timepicker").timepicker({minuteStep:15,showInputs:!1,disableFocus:!0}),$("#main-content").on("click",".close",function(){$(this).parent().parent().parent().remove()}),$(".currency").maskMoney(),$(".nav-item").click(function(){Friendly.StartLoading();var a=$("ul .active").children(":first-child").attr("data-form"),b=$(this).children(":first-child").attr("data-form");Friendly.SubmitForm(a,b)||Friendly.NextForm(b,Friendly.properties.iconError)}),$("#ViewOutput").live("click",function(){document.location.href=$(this).attr("data-url")}),$("#login-form input[type=submit]").click(function(a){a&&a.preventDefault();var b=$("#login-form"),c=b.attr("data-continue");b.valid()&&(Friendly.StartLoading("Logging in...Please wait"),$.ajax({type:"POST",url:b.attr("action")+"?format=json",data:Friendly.GetFormInput("login-form"),success:function(){document.location.href=c,Friendly.EndLoading()},error:Friendly.GenericErrorMessage}))}),$("#logOff").live("click",function(){$.ajax({url:"/api/auth/logout",success:function(){document.location.href="/"},error:Friendly.GenericErrorMessage})}),$.ajax({url:"/api/userauths?format=json",success:function(a){var b=$("#friendly-login-template").html();$("#user-nav").append(_.template(b,a.UserSession))},error:Friendly.GenericErrorMessage})})