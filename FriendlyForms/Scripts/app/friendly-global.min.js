window.Friendly=window.Friendly||{},Friendly.properties={messageType:{Warning:"",Success:"alert-success",Error:"alert-error"},iconSuccess:"icon-green icon-ok",iconEdit:"icon-blue icon-pencil",iconError:"icon-red icon-pencil",numberRegEx:/(\d{1,5})/},Friendly.children=[],Friendly.childNdx=0,Friendly.StartLoading=function(){$("#loading").show(),$("body").css("cursor","wait")},Friendly.EndLoading=function(){$("#loading").hide(),$("body").css("cursor","default")},Friendly.ShowMessage=function(a,b,c,d){Friendly.EndLoading(),c=typeof c=="undefined"?Friendly.properties.messageType.Warning:c;var e={Title:a,Message:b,AlertType:c},f=$("#friendly-message-template").tmpl(e);typeof d=="undefined"&&(d="#main-content"),$(d).prepend(f)},Friendly.GenericErrorMessage=function(a,b,c){Friendly.EndLoading();if(a.responseText!=""&&a.responseText[0]!="<"){var d=JSON.parse(a.responseText);if(c==="Bad Request")return Friendly.ShowMessage("Input Error",d.ResponseStatus.Message,Friendly.properties.messageType.Error),!1}return Friendly.ShowMessage("Sorry!","We could not process your request.  The error has been logged and we will do our best to correct the error asap.",Friendly.properties.messageType.Error),!1},Friendly.SubmitForm=function(a,b,c){Friendly.StartLoading(),typeof c=="undefined"&&(c=Friendly.GetFormInput(a));var d="#"+a;if($(d).valid())$.ajax({url:"/api/"+a+"?format=json",type:"POST",data:c,success:function(){return $("html, body").animate({scrollTop:0},"fast"),Friendly.NextForm(b,Friendly.properties.iconSuccess),Friendly.EndLoading(),!1},error:Friendly.GenericErrorMessage});else return Friendly.EndLoading(),!1;return!1},Friendly.SubmitFormOther=function(a,b,c){Friendly.StartLoading(),typeof c=="undefined"&&(c=Friendly.GetFormInput(a)),c.isOtherParent="true";var d="#"+a,e=a.substring(0,a.lastIndexOf("Other"));if($(d).valid())$.ajax({url:"/api/"+e+"/?format=json",type:"POST",data:c,success:function(){return $("html, body").animate({scrollTop:0},"fast"),Friendly.NextForm(b,Friendly.properties.iconSuccess),Friendly.EndLoading(),!1},error:Friendly.GenericErrorMessage});else return Friendly.EndLoading(),!1;return!1},Friendly.NextForm=function(a,b){$("#sidebar .active").find("i").attr("class",b),$("#"+a+"Nav").find("i").attr("class",Friendly.properties.iconEdit),$(".wrapper").hide();switch(a){case"preexistingSupport":$('#preexistingSupport input[id="PreexistingSupportViewModel_Support"]:checked').val()==="1"&&$("#supportWrapper").show();break;case"preexistingOther":$('#preexistingOther input[id="PreexistingSupportViewModel_Support"]:checked').val()==="1"&&$("#supportOtherWrapper").show();break;case"decisions":loadChildren("decision");break;case"holiday":loadChildren("holiday")}$("#sidebar li").removeClass("active"),$("#"+a+"Wrapper").show(),$("#"+a+"Nav").addClass("active"),Friendly.EndLoading()},Friendly.GetFormInput=function(a){var b={};return $.each($("#"+a).serializeArray(),function(a,c){c.name.indexOf(".")>=0&&(c.name=c.name.substring(c.name.indexOf(".")+1,c.name.length)),b[c.name]=c.value}),b.UserId=$("#user-id").val(),b},Friendly.ClearForm=function(a){$(":input","#"+a).not(":button, :submit, :reset, :hidden, :radio").val("").removeAttr("selected"),$(":input","#"+a).not(":button, :submit, :reset, :hidden,").removeAttr("checked").removeAttr("selected")},Friendly.ValidateForms=function(a,b,c){var d=!0,e=[],f=$(".nav-item");for(var g=0;g<f.length;g++)!$(f[g]).find("i").hasClass("icon-ok")&&!$(f[g]).find("i").hasClass("icon-blue")&&(d=!1,e.push($(f[g]).find("a").text()));if(!d){var h="The following forms are still incomplete or have errors: ";for(var i=0;i<e.length-1;i++)h+=e[i]+", ";return h+=e[e.length-1],Friendly.ShowMessage("Almost there!",h,Friendly.properties.messageType.Error),$("html, body").animate({scrollTop:0},"fast"),!1}$(c).hide(),$(".viewOutput").show()},Friendly.IsGenericForm=function(a,b){var c=["vehicle","children","decisions","holiday","preexistingSupport","preexistingSupportOther"];if(c.indexOf(a)>=0){switch(a){case"vehicle":if($("#vehicleForm").valid()){var d=Friendly.GetFormInput("vehicleForm");$.ajax({url:"/api/VehicleForm?format=json",type:"POST",data:d,success:function(){Friendly.NextForm(b,Friendly.properties.iconSuccess)},error:Friendly.GenericErrorMessage})}else Friendly.NextForm(b,Friendly.properties.iconError);break;case"children":if($("#childForm").valid()){var e=Friendly.GetFormInput("childForm");$.ajax({url:"/api/ChildForm?format=json",type:"POST",data:e,success:function(){Friendly.NextForm(b,Friendly.properties.iconSuccess)},error:Friendly.GenericErrorMessage})}else Friendly.NextForm(b,Friendly.properties.iconError);break;case"decisions":if(Friendly.AddDecision()){Friendly.childNdx=0;var f=Friendly.children[Friendly.childNdx];Friendly.CheckChildDecision(f,b)}else Friendly.NextForm(b,Friendly.properties.iconError);break;case"holiday":if(addHoliday()){Friendly.childNdx=0;var f=Friendly.children[Friendly.childNdx];Friendly.CheckChildHoliday(f,b)}else Friendly.NextForm(b,Friendly.properties.iconError);Friendly.EndLoading();break;case"preexistingSupport":Friendly.NextForm(b,Friendly.properties.iconSuccess);break;case"preexistingSupportOther":Friendly.NextForm(b,Friendly.properties.iconSuccess)}return!1}return!0},Friendly.AddDecision=function(a){var b="decisions";if(!$("#"+b).valid())return!1;saveExtraDecisions(),a!=null&&$(a).hasClass("next")?Friendly.childNdx++:a!=null&&Friendly.childNdx--;var c=Friendly.GetFormInput(b);return c.ChildId=$("#childId").val().trim(),a!=null&&$(a).hasClass("next")&&Friendly.childNdx===Friendly.children.length?(Friendly.SubmitForm(b,"responsibility",c),!1):a!=null&&$(a).hasClass("previous")&&Friendly.childNdx<0?(Friendly.SubmitForm(b,"information",c),!1):($.ajax({url:"/api/"+b+"/?format=json",type:"POST",data:c,success:function(){$("html, body").animate({scrollTop:0},"fast"),$("input[id=DecisionsViewModel_Education]").removeAttr("checked"),$("input[id=DecisionsViewModel_HealthCare]").removeAttr("checked"),$("input[id=DecisionsViewModel_Religion]").removeAttr("checked"),$("input[id=DecisionsViewModel_ExtraCurricular]").removeAttr("checked");var a=Friendly.children[Friendly.childNdx];getChildDecisions(a)},error:Friendly.GenericErrorMessage}),!0)},Friendly.CheckChildDecision=function(a,b){$.ajax({url:"/api/Decisions?ChildId="+a.Id+"&format=json",type:"GET",success:function(c){return $("#childName").text(a.Name),$("#childId").val(a.Id),$('#DecisionsViewModel_Education[value="'+c.Decisions.Education+'"]').attr("checked","checked"),$('#DecisionsViewModel_HealthCare[value="'+c.Decisions.HealthCare+'"]').attr("checked","checked"),$('#DecisionsViewModel_Religion[value="'+c.Decisions.Religion+'"]').attr("checked","checked"),$('#DecisionsViewModel_ExtraCurricular[value="'+c.Decisions.ExtraCurricular+'"]').attr("checked","checked"),$("#DecisionsViewModel_BothResolve").val(c.Decisions.BothResolve),$(".extra-decision-item").remove(),Friendly.childNdx++,Friendly.childNdx===Friendly.children.length?$("#decisions").valid()?(Friendly.NextForm(b,Friendly.properties.iconSuccess),!1):(Friendly.NextForm(b,Friendly.properties.iconError),!1):$("#decisions").valid()?(Friendly.CheckChildDecision(Friendly.children[Friendly.childNdx],b),!1):(Friendly.NextForm(b,Friendly.properties.iconError),!1)},error:Friendly.GenericErrorMessage})},Friendly.CheckChildHoliday=function(a,b){$.ajax({url:"/api/Holiday/"+a.Id+"?format=json",type:"GET",success:function(c){return setChildHolidayForm(c,a),Friendly.childNdx++,Friendly.childNdx===Friendly.children.length?$("#holiday").valid()?(Friendly.NextForm(b,Friendly.properties.iconSuccess),!1):(Friendly.NextForm(b,Friendly.properties.iconError),!1):$("#holiday").valid()?(Friendly.CheckChildHoliday(Friendly.children[Friendly.childNdx],b),!1):(Friendly.NextForm(b,Friendly.properties.iconError),!1)},error:Friendly.GenericErrorMessage})},$(document).ready(function(){function b(){var a=$("#user-nav > ul").width();$("#user-nav > ul").css({width:a,"margin-left":"-"+a/2+"px"});var b=$("#content-header .btn-group").width();$("#content-header .btn-group").css({width:b,"margin-left":"-"+a/2+"px"})}function i(a){var b=/Other/g;return a.search(b)!=-1?!0:!1}$(".submenu > a").click(function(a){a.preventDefault();var b=$(this).siblings("ul"),c=$(this).parents("li"),d=$("#sidebar li.submenu ul"),e=$("#sidebar li.submenu");c.hasClass("open")?($(window).width()>768||$(window).width()<479?b.slideUp():b.fadeOut(250),c.removeClass("open")):($(window).width()>768||$(window).width()<479?(d.slideUp(),b.slideDown()):(d.fadeOut(250),b.fadeIn(250)),e.removeClass("open"),c.addClass("open"))});var a=$("#sidebar > ul");$("#sidebar > a").click(function(b){b.preventDefault();var c=$("#sidebar");c.hasClass("open")?(c.removeClass("open"),a.slideUp(250)):(c.addClass("open"),a.slideDown(250))}),$(window).resize(function(){$(window).width()>479&&(a.css({display:"block"}),$("#content-header .btn-group").css({width:"auto"})),$(window).width()<479&&(a.css({display:"none"}),b()),$(window).width()>768&&($("#user-nav > ul").css({width:"auto",margin:"0"}),$("#content-header .btn-group").css({width:"auto"}))}),$(window).width()<468&&(a.css({display:"none"}),b()),$(window).width()>479&&($("#content-header .btn-group").css({width:"auto"}),a.css({display:"block"})),$(".hoverHelp").popover({placement:"left",title:"Tip",trigger:"hover"}),$("input[type=checkbox]").click(function(){var a=$(this).attr("checked");a!=undefined?$(this).val(!0):$(this).val(!1)}),$.validator.addMethod("textlineinput",function(a,b,c){return this.optional(b)?!0:a.split("\\")[0]===c}),$.validator.unobtrusive.adapters.add("textlineinput",["name"],function(a){a.rules.textlineinput=a.params.name,a.message&&(a.messages.textlineinput=a.message)});var c=$("form"),d=[],e=[],f=[];for(var g=0;g<c.length;g++){var h=$.data(c[g],"validator").settings;d[g]=h.errorPlacement,e[g]=h.success,f[g]=h.invalidHandler,h.formNdx=g,h.errorPlacement=function(a,b){$(b).closest(".control-group").addClass("error"),!!$.data(c[this.formNdx],"validator").valid(),d[this.formNdx](a,b)},h.success=function(a){$(a).closest(".control-group").removeClass("error"),e[this.formNdx](a)},h.invalidHandler=function(a){f[this.formNdx]()}}$(".datepicker").datepicker(),$(".timepicker").timepicker({minuteStep:15,showInputs:!1,disableFocus:!0}),$("#main-content").on("click",".close",function(){$(this).parent().parent().parent().remove()}),$(".currency").mask("000,000,000,000,000",{reverse:!0}),$(".nav-item").click(function(){Friendly.StartLoading();var a=$("ul .active").children(":first-child").attr("data-form"),b=$(this).children(":first-child").attr("data-form"),c=Friendly.IsGenericForm(a,b);if(c&&$("#"+a).valid()){var d=Friendly.GetFormInput(a,b);i(a)&&(a=a.substring(0,a.lastIndexOf("Other")),d.isOtherParent="true"),$.ajax({url:"/api/"+a+"?format=json",type:"POST",data:d,success:function(){return $("html, body").animate({scrollTop:0},"fast"),Friendly.NextForm(b,Friendly.properties.iconSuccess),Friendly.EndLoading(),!1},error:Friendly.GenericErrorMessage})}else c&&(Friendly.NextForm(b,Friendly.properties.iconError),Friendly.EndLoading())}),$("#ViewOutput").live("click",function(){document.location.href=$(this).attr("data-url")})})